<!DOCTYPE html>
<html>
<head>
  <script src="/OpenTS/js/jquery.min.js"></script>
  <link rel="icon" type="image/png" href="https://decisionintelligence.github.io/OpenTS/figures/logo10.png">
  <meta name="google-site-verification" content="0HzGL60Z8ChYs-wL6ogMpNB-px7tcu9PcRD1z6OQWe8" />
  <meta name="msvalidate.01" content="FD2A799A0C64AAB3A8289819F1C2DFFB" />
  <meta http-equiv="Access-Control-Allow-Origin" content="*">
  <meta http-equiv='content-language' content='en-gb'>
  <meta charset="utf-8">
  
  
  <title>OpenTS - A Comprehensive and Fair Benchmark for Time Series Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="subtitle" content="A Comprehensive and Fair Benchmark for Time Series Analytics">
  <meta name="description" content="Steps to develop your own methodThis is a tutorial for developing your own method.  You can refer to the following steps: 1. Create a “your_model.py” (or whatever name you prefer, but remember to upda">
<meta property="og:type" content="website">
<meta property="og:title" content="OpenTS - A Comprehensive and Fair Benchmark for Time Series Analytics">
<meta property="og:url" content="https://decisionintelligence.github.io/OpenTS/en/zh-cn/get%20started/steps_to_develop_your_own_method.html">
<meta property="og:site_name" content="OpenTS - A Comprehensive and Fair Benchmark for Time Series Analytics">
<meta property="og:description" content="Steps to develop your own methodThis is a tutorial for developing your own method.  You can refer to the following steps: 1. Create a “your_model.py” (or whatever name you prefer, but remember to upda">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-10-21T03:54:46.520Z">
<meta property="article:modified_time" content="2024-10-21T03:54:46.520Z">
<meta property="article:author" content="DecisionIntelligence |">
<meta name="twitter:card" content="summary">
  

  <link href="/OpenTS/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/OpenTS/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="/OpenTS/css/style.css">

  

<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?8864d";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->
<!-- jiangting add start... @2020.08.30 -->

<!-- jiangting add end !  @2020.08.30 -->

<header id="header" style="min-width:1040px">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <!-- <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a> -->
      

      <nav id="main-nav">
        
        
          
          
            <div class="menu-container" data-lang="zh-cn">
              <a id="logo" style="margin:3px 0" class="logo" href="/OpenTS/"></a>
              
                
                
                
                  <a class="main-nav-link" href="/OpenTS/zh-cn/overview">概述</a>
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">开始 <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/zh-cn/get%20started/#Quickstart">快速开始</a>
                      
                        <a href="/OpenTS/zh-cn/get%20started/#Steps-to-develop-your-own-method">Steps to develop your own method</a>
                      
                        <a href="/OpenTS/zh-cn/get%20started/#Steps-to-evaluate-on-your-own-time-series">Steps to evaluate on your own time series</a>
                      
                        <a href="/OpenTS/zh-cn/get%20started/#Pipeline-introduction">Pipeline introduction</a>
                      
                        <a href="/OpenTS/zh-cn/get%20started/#FAQ">FAQ</a>
                      
                        <a href="/OpenTS/zh-cn/get%20started/#Citing-us">Citing us</a>
                      
                        <a href="/OpenTS/zh-cn/get%20started/#Contact">Contact</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">数据集 <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/zh-cn/datasets/#Overview">概述</a>
                      
                        <a href="/OpenTS/zh-cn/datasets/#Univariate-time-series">单变时间序列</a>
                      
                        <a href="/OpenTS/zh-cn/datasets/#Multivariate-time-series">多变时间序列</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">算法 <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/zh-cn/algorithms/methods/#Specific-Methods-introduction">端到端模型</a>
                      
                        <a href="/OpenTS/zh-cn/algorithms/methods/#Foundation-Methods-introduction">基础模型</a>
                      
                        <a href="/OpenTS/zh-cn/algorithms/AutoCTS">自动机器学习</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">排行榜 <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/zh-cn/leaderboards/univariate_time_series">Univariate time series</a>
                      
                        <a href="/OpenTS/zh-cn/leaderboards/multivariate_time_series">Multivariate time series</a>
                      
                        <a href="/OpenTS/zh-cn/leaderboards/foundation_model">Foundation model</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <a class="main-nav-link" href="/OpenTS/zh-cn/team">团队</a>
                
      
              
                
                
                
                  <a class="main-nav-link" href="/OpenTS/zh-cn/papers">论文</a>
                
      
              
                
                
                
                  <a class="main-nav-link" target="_blank" rel="noopener" href="https://github.com/decisionintelligence/TFB">Github</a>
                
      
              
                
                
                
                  <a id="lang-toggle-link-zh-cn" class="main-nav-link" href="javascript:;">中文|English</a>
                
                
                
      
              
            </div>
          
        
          
          
            <div class="menu-container" data-lang="en">
              <a id="logo" style="margin:3px 0" class="logo" href="/OpenTS/"></a>
              
                
                
                
                  <a class="main-nav-link" href="/OpenTS/en/overview">Overview</a>
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">Get Started <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/en/get%20started/#Quickstart">Quickstart</a>
                      
                        <a href="/OpenTS/en/get%20started/#Steps-to-develop-your-own-method">Steps to develop your own method</a>
                      
                        <a href="/OpenTS/en/get%20started/#Steps-to-evaluate-on-your-own-time-series">Steps to evaluate on your own time series</a>
                      
                        <a href="/OpenTS/en/get%20started/#Pipeline-introduction">Pipeline introduction</a>
                      
                        <a href="/OpenTS/en/get%20started/#FAQ">FAQ</a>
                      
                        <a href="/OpenTS/en/get%20started/#Citing-us">Citing us</a>
                      
                        <a href="/OpenTS/en/get%20started/#Contact">Contact</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">Datasets <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/en/datasets/#Overview">Overview</a>
                      
                        <a href="/OpenTS/en/datasets/#Univariate-time-series">Univariate time series</a>
                      
                        <a href="/OpenTS/en/datasets/#Multivariate-time-series">Multivariate time series</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">Algorithms <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/en/algorithms/methods/#Specific-Methods-introduction">Specific models</a>
                      
                        <a href="/OpenTS/en/algorithms/methods/#Foundation-Methods-introduction">Foundation models</a>
                      
                        <a href="/OpenTS/en/algorithms/AutoCTS">AutoML methods</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <div class="dropdown">
                    <a class="main-nav-link dropdown-toggle">Leaderboards <span class="caret"></span></a>
                    <div class="dropdown-content">
                      
                        <a href="/OpenTS/en/leaderboards/univariate_time_series">Univariate time series</a>
                      
                        <a href="/OpenTS/en/leaderboards/multivariate_time_series">Multivariate time series</a>
                      
                        <a href="/OpenTS/en/leaderboards/foundation_model">Foundation model</a>
                      
                    </div>
                  </div>
      
                
                
      
              
                
                
                
                  <a class="main-nav-link" href="/OpenTS/en/team">Team</a>
                
      
              
                
                
                
                  <a class="main-nav-link" href="/OpenTS/en/papers">Papers</a>
                
      
              
                
                
                
                  <a class="main-nav-link" target="_blank" rel="noopener" href="https://github.com/decisionintelligence/TFB">Github</a>
                
      
              
            </div>
          
        
      </nav>
    
    </div>
  </div>
</header>

<style>
  #header {
    position: relative;
    z-index: 10;
    overflow: visible;
  }

  #header-outer {
    position: relative;
    z-index: 10;
    overflow: visible;
  }

  #header-inner {
    position: relative;
    z-index: 10;
    overflow: visible;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 10px;
    width: 1000px; /* 设置最大宽度 */
    margin: auto; /* 居中对齐 */ /* 确保占满父元素的宽度 */
    flex-wrap: nowrap; /* 保持内容在同一行 */
  }

  .dropdown {
    position: relative;
    display: inline-block;
    text-align: right;
  }

  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1000;
    top: 100%;
    right: 0;
    width: auto;
    min-width: 100%;
    white-space: nowrap;
  }

  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
    border-top: 1px solid #ddd;
  }

  .dropdown-content a:first-child {
    border-top: none;
  }

  .dropdown-content a:hover {
    background-color: #f1f1f1;
  }

  .dropdown:hover .dropdown-content {
    display: block;
  }

  .dropdown-toggle::after {
    content: " ▼";
    font-size: 0.55em;
    vertical-align: middle;
  }

  #main-nav {
    display: flex;
    align-items: center;
    flex-grow: 1;
    justify-content: space-around;
    flex-wrap: nowrap; /* 保持内容在同一行 */
  }

  .main-nav-link {
    padding: 0 10px; /* 减少 padding，缩小栏目间距 */
  }

  

  @media (max-width: 480px) {
    .main-nav-link {
      padding: 5px; /* 进一步减少 padding，在小屏幕上更紧凑 */
      flex: 1;
      text-align: center;
    }
  }
</style>

    <br>
    <section id="main" class="outer"><article id="page-" class="article article-type-page" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    <div class="article-meta">
      <!--<a href="/OpenTS/en/zh-cn/get%20started/steps_to_develop_your_own_method.html" class="article-date">
  <time datetime="2024-10-21T03:54:46.520Z" itemprop="datePublished">2024-10-21</time>
</a>-->
      <!-- 
--><!-- by blair 160724 -->
      <!-- by blair
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Steps-to-develop-your-own-method"><a href="#Steps-to-develop-your-own-method" class="headerlink" title="Steps to develop your own method"></a>Steps to develop your own method</h2><p>This is a tutorial for developing your own method.  You can refer to the following steps:</p>
<h3 id="1-Create-a-“your-model-py”-or-whatever-name-you-prefer-but-remember-to-update-the-commands-in-the-subsequent-sections-accordingly-under-the-ts-benchmark-baselines-directory"><a href="#1-Create-a-“your-model-py”-or-whatever-name-you-prefer-but-remember-to-update-the-commands-in-the-subsequent-sections-accordingly-under-the-ts-benchmark-baselines-directory" class="headerlink" title="1. Create a “your_model.py” (or whatever name you prefer, but remember to update the commands in the subsequent sections accordingly) under the .&#x2F;ts_benchmark&#x2F;baselines&#x2F; directory."></a>1. Create a “your_model.py” (or whatever name you prefer, but remember to update the commands in the subsequent sections accordingly) under the .&#x2F;ts_benchmark&#x2F;baselines&#x2F; directory.</h3><h3 id="2-Define-your-model"><a href="#2-Define-your-model" class="headerlink" title="2. Define your model"></a>2. Define your model</h3><ul>
<li><p>The user-implemented model class should inherit the class <strong>ModelBase</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> statsmodels.tsa.api <span class="keyword">import</span> VAR <span class="keyword">as</span> VARModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ts_benchmark.models.model_base <span class="keyword">import</span> ModelBase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VAR</span>(<span class="title class_ inherited__">ModelBase</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    VAR class.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This class encapsulates a process of using VAR models for time series prediction.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, lags=<span class="number">13</span></span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        self.scaler = StandardScaler()</span><br><span class="line">        self.lags = lags</span><br><span class="line">        self.results = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Implement  <strong>forecast_fit</strong>  method to train your model</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forecast_fit</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self, train_data: pd.DataFrame, *, train_ratio_in_tv: <span class="built_in">float</span> = <span class="number">1.0</span>, **kwargs</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="string">&quot;ModelBase&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Train the model.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param train_data: Time series data used for training.</span></span><br><span class="line"><span class="string">    :param train_ratio_in_tv: Represents the splitting ratio of the training set validation set.</span></span><br><span class="line"><span class="string">        If it is equal to 1, it means that the validation set is not partitioned.</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">    :return: The fitted model object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    self.scaler.fit(train_data.values)</span><br><span class="line">    train_data_value = pd.DataFrame(</span><br><span class="line">        self.scaler.transform(train_data.values),</span><br><span class="line">        columns=train_data.columns,</span><br><span class="line">        index=train_data.index,</span><br><span class="line">    )</span><br><span class="line">    model = VARModel(train_data_value)</span><br><span class="line">    self.results = model.fit(self.lags)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>
</li>
<li><p>Implement <strong>forecast</strong> method to inference with your model</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forecast</span>(<span class="params">self, horizon: <span class="built_in">int</span>, series: pd.DataFrame, **kwargs</span>) -&gt; np.ndarray:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Make predictions.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param horizon: The predicted length.</span></span><br><span class="line"><span class="string">    :param series: Time series data used for prediction.</span></span><br><span class="line"><span class="string">    :return: An array of predicted results.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    train = pd.DataFrame(</span><br><span class="line">        self.scaler.transform(series.values),</span><br><span class="line">        columns=series.columns,</span><br><span class="line">        index=series.index,</span><br><span class="line">    )</span><br><span class="line">    z = self.results.forecast(train.values, steps=horizon)</span><br><span class="line"></span><br><span class="line">    predict = self.scaler.inverse_transform(z)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> predict</span><br></pre></td></tr></table></figure>
</li>
<li><p>Because VAR does not support <strong>batch_forecast</strong>, this method is not implemented in this tutorial.</p>
</li>
<li><p>Implement <strong>required_hyper_params</strong> method.  This method only needs to be overwritten if your model requires this mechanism. It is provided here as an instructional example.</p>
<blockquote>
<p><strong>About required_hyper_params</strong></p>
<p>This is a specially designed mechanism to enable models to relinquish the settings of some hyperparameters to the benchmark (We do not enforce the model to adhere to these parameter values). The method should return a key-value dictionary where the key is the model’s hyperparameter name and the value is the parameter name defined globally in <strong>recommend_model_hyper_params</strong>. </p>
<p>For example, if a model cannot automatically decide the best input window size (corresponding hyperparameter <strong>input_window_size</strong>), it can leave the decision to the benchmark, so that the benchmark can use a globally recommended setting (corresponding hyperparameter <strong>input_chunk_length</strong>) to produce a fair comparison between different models;<br> In this example, to enable this mechanism properly, the model is required to provide a <strong>required_hyper_params</strong> field in dictionary <strong>{“input_window_size”: “input_chunk_length”}</strong>.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">required_hyper_params</span>() -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Return the hyperparameters required by VAR.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return: An empty dictionary indicating that VAR does not require additional hyperparameters.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Implement <strong>model_name</strong> method which returns a string representation of the model name</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">model_name</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Returns the name of the model.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;VAR&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>Now, let’s put it all together:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> statsmodels.tsa.api <span class="keyword">import</span> VAR <span class="keyword">as</span> VARModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ts_benchmark.models.model_base <span class="keyword">import</span> ModelBase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VAR</span>(<span class="title class_ inherited__">ModelBase</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    VAR class.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This class encapsulates a process of using VAR models for time series prediction.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, lags=<span class="number">13</span></span>):</span><br><span class="line">        self.scaler = StandardScaler()</span><br><span class="line">        self.lags = lags</span><br><span class="line">        self.results = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">model_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Returns the name of the model.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;VAR&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">required_hyper_params</span>() -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return the hyperparameters required by VAR.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :return: An empty dictionary indicating that VAR does not require additional hyperparameters.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forecast_fit</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, train_data: pd.DataFrame, *, train_ratio_in_tv: <span class="built_in">float</span> = <span class="number">1.0</span>, **kwargs</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="string">&quot;ModelBase&quot;</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Train the model.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param train_data: Time series data used for training.</span></span><br><span class="line"><span class="string">        :param train_ratio_in_tv: Represents the splitting ratio of the training set validation set. If it is equal to 1, it means that the validation set is not partitioned.</span></span><br><span class="line"><span class="string">        :return: The fitted model object.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self.scaler.fit(train_data.values)</span><br><span class="line">        train_data_value = pd.DataFrame(</span><br><span class="line">            self.scaler.transform(train_data.values),</span><br><span class="line">            columns=train_data.columns,</span><br><span class="line">            index=train_data.index,</span><br><span class="line">        )</span><br><span class="line">        model = VARModel(train_data_value)</span><br><span class="line">        self.results = model.fit(self.lags)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forecast</span>(<span class="params">self, horizon: <span class="built_in">int</span>, series: pd.DataFrame, **kwargs</span>) -&gt; np.ndarray:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Make predictions.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param horizon: The predicted length.</span></span><br><span class="line"><span class="string">        :param series: Time series data used for prediction.</span></span><br><span class="line"><span class="string">        :return: An array of predicted results.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        train = pd.DataFrame(</span><br><span class="line">            self.scaler.transform(series.values),</span><br><span class="line">            columns=series.columns,</span><br><span class="line">            index=series.index,</span><br><span class="line">        )</span><br><span class="line">        z = self.results.forecast(train.values, steps=horizon)</span><br><span class="line"></span><br><span class="line">        predict = self.scaler.inverse_transform(z)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> predict</span><br></pre></td></tr></table></figure>



<h3 id="3-Choose-your-configuration-file"><a href="#3-Choose-your-configuration-file" class="headerlink" title="3. Choose your configuration file"></a>3. Choose your configuration file</h3><ul>
<li><p>Please select a config file from the <strong>.&#x2F;config</strong> directory based on your needs, such as choosing the <strong>.&#x2F;config&#x2F;rolling_forecast_config.json</strong>.</p>
</li>
<li><p>TODO:  There will be a dedicated tutorial on how to write your own config file in the future.</p>
</li>
</ul>
<h3 id="4-Run-it"><a href="#4-Run-it" class="headerlink" title="4. Run it"></a>4. Run it</h3><p>Make sure to set the value of the –model-name parameter to <strong>“your_model.VAR&quot;</strong>.</p>
<p><strong>“your_model”</strong> is the name of the Python module you created. The pipeline will search for this module relative to <strong>.&#x2F;ts_benchmark&#x2F;baselines</strong>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ./scripts/run_benchmark.py --config-path &quot;rolling_forecast_config.json&quot; --data-name-list &quot;ILI.csv&quot; --strategy-args &#x27;&#123;&quot;horizon&quot;:24&#125;&#x27; --model-name &quot;your_model.VAR&quot; --num-workers 1  --timeout 60000  --save-path &quot;saved_path&quot;</span><br></pre></td></tr></table></figure>
      
    
    </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        

      </footer>
    
  </div>
  
    
  
</article>

</section>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 DecisionIntelligence |&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a target="_blank" rel="noopener" href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer> -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" >
</script>

    






<script src="/OpenTS/js/script.js"></script>


  </div>
  <!-- 把它放在 </body> 标签之前 -->
<script>
  // function updateLanguageLink() {
  //   // 获取页面上我们设置的那个链接元素
  //   const link = document.getElementById('lang-toggle-link');
  //   if (!link) {
  //     // 如果页面上没有这个链接，就什么都不做
  //     return;
  //   }

  //   // 这两个值需要和你的项目配置保持一致
  //   const DEFAULT_LANG = 'zh-cn'; // 你的默认语言，可能是 'zh' 或 'zh-cn'
  //   const SECOND_LANG = 'en';

  //   // 不再使用 page.path，而是使用浏览器当前真实的 URL
  //   const currentPathname = window.location.pathname;
    
  //   // 从 config 中获取站点的根目录，以便正确拼接 URL
  //   // hexo.config.root 通常是 '/' 或者 '/your-repo-name/'
  //   const root = '/OpenTS/';
  //   // console.log(currentPathname)
  //   // console.log(root)
  //   let targetPath;

  //   // 判断当前 URL 是否以 /en/ 开头
  //   if (currentPathname.startsWith(root + SECOND_LANG + '/')) {
  //     // 当前是英文页, 目标是中文页
  //     // e.g., /en/get-started/ -> /get-started/
  //     const pathWithoutLang = currentPathname.substring((root + SECOND_LANG).length);
  //     targetPath = root.slice(0, -1) + '/' + DEFAULT_LANG +  pathWithoutLang; // 拼接路径
  //   } else if(currentPathname.startsWith(root + DEFAULT_LANG + '/')){
  //     const pathWithoutLang = currentPathname.substring((root + DEFAULT_LANG).length);
  //     targetPath = root.slice(0, -1) + '/' + 'en' +  pathWithoutLang; // 拼接路径
  //   } 
  //   else {
  //     // 当前是中文页, 目标是英文页
  //     // e.g., /get-started/ -> /en/get-started/
  //     const pathWithoutRoot = currentPathname.substring(root.length);
  //     targetPath = root + SECOND_LANG + '/' + pathWithoutRoot;
  //   }

  //   // 更新链接的 href 属性
  //   link.href = targetPath;
  // }

  // // 监听 Pjax 加载完成事件
  // // 注意：事件名可能是 'pjax:end', 'pjax:complete' 等，取决于主题用的库
  // // 你可以在主题的 JS 文件里搜索 'pjax' 来确认
  // document.addEventListener('pjax:end', updateLanguageLink);

  // // 页面首次加载时也执行一次
  // document.addEventListener('DOMContentLoaded', updateLanguageLink);
  function updateLanguageUI() {
    const root = '/OpenTS/';
    const DEFAULT_LANG = 'en';
    const SECOND_LANG = 'zh-cn';
    const currentPathname = window.location.pathname;

    // --- 1. 更新 Body Class 来切换菜单 ---
    const isEnglishPage = currentPathname.startsWith(root + SECOND_LANG + '/');
    
    if (isEnglishPage) {
      document.body.classList.add('lang-zh-cn');
      document.body.classList.remove('lang-en');
    } else {

      document.body.classList.add('lang-en');
      document.body.classList.remove('lang-zh-cn');
    }

    // --- 2. 更新语言切换链接的 href (新逻辑) ---
    let linkToUpdate;
    let targetPath;

    if (isEnglishPage) {
      // 在英文页，英文菜单可见。我们需要更新它里面的那个切换器。
      // linkToUpdate = document.getElementById('main-nav');
      linkToUpdate = document.getElementById('lang-toggle-link-zh-cn');
      // 目标是中文页 (不带语言前缀)
      const pathWithoutLang = currentPathname.substring((root + SECOND_LANG).length);
      targetPath = (root.endsWith('/') ? root.slice(0, -1) : root)  + '/' + DEFAULT_LANG + pathWithoutLang;
      if (targetPath === '') targetPath = '/';

    } else {
      // 在中文页，中文菜单可见。我们需要更新它里面的那个切换器。
      linkToUpdate = document.getElementById('lang-toggle-link-en');
      // linkToUpdate = document.getElementById('main-nav');
      console.log(linkToUpdate.href)
      // 目标是英文页
      let pathWithoutLang = currentPathname.substring(root.length);
      if (pathWithoutLang.startsWith(DEFAULT_LANG + '/')) {
        pathWithoutLang = pathWithoutLang.substring((DEFAULT_LANG + '/').length);
      }
      targetPath = root + SECOND_LANG + '/' + pathWithoutLang;
    }

    // 如果找到了对应的链接，就更新它
    if (linkToUpdate) {
      linkToUpdate.href = targetPath;
      console.log(linkToUpdate.href)
    }
  }

  // 监听 Pjax 加载完成事件
  document.addEventListener('pjax:end', updateLanguageUI);
  // 页面首次加载时也执行一次
  document.addEventListener('DOMContentLoaded', updateLanguageUI);
</script>
</body>
</html>
